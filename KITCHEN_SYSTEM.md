# 后台出餐功能说明

## 功能概述

我们为咖啡店系统添加了完整的后台出餐功能，包括：

1. **订单接收** - 接收客户的订单
2. **取单号生成** - 为每个订单生成唯一的6位数取单号
3. **出餐确认** - 管理员可以管理订单状态并确认出餐

## 主要功能

### 1. 订单创建与取单号生成

- 客户下单后，系统自动生成6位数的取单号（如：123456）
- 取单号保证唯一性，避免重复
- 下单成功后，客户会看到明显的取单号显示

### 2. 订单状态管理

订单有以下状态：
- `pending` - 待接单（橙色标签）
- `preparing` - 制作中（蓝色标签）
- `ready` - 待取餐（绿色标签）
- `completed` - 已完成（灰色标签）
- `cancelled` - 已取消（红色标签）

### 3. 管理员后台

管理员可以通过后台系统：
- 查看所有订单列表
- 实时查看待接单、制作中、待取餐的订单数量
- 查看订单详情（包括客户信息、商品清单）
- 管理订单状态（接单 → 制作完成 → 确认取餐）
- 取消订单（仅限待接单和制作中状态）

## 操作流程

### 客户端流程

1. 客户浏览商品并添加到购物车
2. 点击结账，系统创建订单
3. 显示取单号，客户记录取单号
4. 客户可以在"我的订单"页面查看订单状态

### 管理员流程

1. 登录管理员账户（用户名：admin，密码：admin123）
2. 进入"订单管理"标签页
3. 查看新订单并点击"接单"
4. 开始制作后点击"制作完成"
5. 客户取餐时点击"确认取餐"

## 技术实现

### 数据库更新

- 在`orders`表中添加了`pickup_number`字段
- 自动为现有订单生成取单号
- 保证取单号的唯一性约束

### API接口

新增以下接口：
- `GET /api/orders` - 获取所有订单（管理员）
- `GET /api/orders/admin/:order_id` - 获取订单详情（管理员）
- `PUT /api/orders/:order_id/status` - 更新订单状态

### 前端更新

- 管理员页面新增订单管理功能
- 订单列表显示取单号和状态
- 购物车页面显示下单成功的取单号
- 客户订单页面显示取单号

## 使用说明

1. **启动系统**：
   ```bash
   # 启动服务器
   npm start
   
   # 启动客户端
   cd client && npm start
   ```

2. **访问地址**：
   - 客户端：http://localhost:3000
   - 管理员：http://localhost:3000 (使用admin账户登录)

3. **测试流程**：
   - 注册普通用户账户
   - 下单并记录取单号
   - 使用admin账户登录查看订单管理
   - 测试订单状态流转

## 注意事项

- 取单号为6位数字，确保唯一性
- 只有管理员可以更改订单状态
- 已完成的订单无法再次修改状态
- 系统会自动为现有订单生成取单号

## 扩展功能建议

1. 添加订单打印功能
2. 支持订单备注
3. 添加预计完成时间
4. 短信或邮件通知客户
5. 订单统计和报表功能 